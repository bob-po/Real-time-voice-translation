# 实时语音翻译系统

## 项目简介

这是一个基于Python开发的实时语音翻译系统，支持多语言语音识别和翻译，提供透明悬浮字幕显示。系统采用PyQt5构建用户界面，支持网络和本地两种语音识别模式，能够实时将语音转换为文字并进行翻译显示。

## 功能特性

### 🎯 核心功能
- **实时语音识别**: 支持中英文等多种语言的语音识别
- **多语言翻译**: 支持8种语言之间的互译
- **透明悬浮字幕**: 半透明悬浮窗口，不遮挡其他应用
- **双语显示**: 支持原文、译文、双语三种显示模式
- **音频可视化**: 实时音频波形动画效果

### 🔧 技术特性
- **双识别模式**: 网络识别（Google Speech Recognition）和本地识别（Vosk）
- **性能优化**: 使用缓存机制、队列管理、线程优化
- **可配置界面**: 支持字体大小、麦克风选择、显示模式等设置
- **拖拽移动**: 支持鼠标拖拽移动字幕位置
- **右键菜单**: 快速访问设置和退出功能

### 🌍 支持语言
- **识别语言**: 中文(zh)、英文(en)、日文(ja)、法文(fr)、德文(de)、西班牙文(es)、俄文(ru)、韩文(ko)
- **翻译语言**: 支持上述8种语言之间的互译

## 系统要求

### 硬件要求
- 麦克风设备
- 至少2GB内存
- 支持音频输入

### 软件要求
- Python 3.7+
- Windows 10/11 (推荐)
- 网络连接（网络识别模式需要）

## 安装指南

### 1. 克隆项目
```bash
git clone https://github.com/bob-po/Real-time-voice-translation.git
cd Real-time-voice-translation
```

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

### 3. 下载语音模型（可选）
如需使用本地识别模式，请下载对应的语音模型：
- 中文模型：`model-cn/`
- 英文模型：`model-en/`

## 使用方法

### 启动应用
```bash
python Real-time-voice-translation/transparent_subtitle_optimized.py
```

### 基本操作
1. **启动后**：应用会显示一个半透明的悬浮窗口
2. **开始说话**：对着麦克风说话，系统会自动识别并翻译
3. **移动位置**：鼠标拖拽窗口可以改变字幕位置
4. **打开设置**：右键点击窗口选择"设置"

### 设置选项
- **识别语言**: 选择语音识别的源语言
- **翻译目标**: 选择翻译的目标语言
- **麦克风**: 选择使用的音频输入设备
- **字体大小**: 调整字幕字体大小（16-48）
- **字幕展示**: 双语/仅原文/仅译文
- **识别方式**: 网络/本地

## 技术架构

### 核心组件

#### 1. TransparentSubtitle (主窗口类)
- 负责UI显示和用户交互
- 管理字幕更新和动画效果
- 处理鼠标事件和右键菜单

#### 2. AudioProcessor (音频处理类)
- 负责音频设备管理和音频采集
- 支持多麦克风选择和音频流控制
- 提供音频能量计算功能

#### 3. TranslationManager (翻译管理类)
- 管理语言包和翻译缓存
- 自动下载缺失的语言包
- 提供高效的翻译服务

#### 4. SettingsDialog (设置对话框)
- 提供用户配置界面
- 支持实时设置更新
- 重启识别线程以应用新设置

### 线程架构
```
主线程 (UI)
├── 识别线程 (语音识别)
├── 更新定时器 (字幕更新)
└── 波形定时器 (动画效果)
```

### 数据流
```
麦克风 → AudioProcessor → 识别线程 → 翻译 → 队列 → UI更新
```

## 性能优化

### 1. 缓存机制
- **翻译缓存**: 避免重复翻译相同文本
- **字体缓存**: 减少字体对象创建开销
- **语言包缓存**: 缓存已安装的语言包

### 2. 队列管理
- **有限队列**: 防止内存溢出
- **非阻塞操作**: 避免UI卡顿
- **数据丢弃策略**: 队列满时丢弃旧数据

### 3. 线程优化
- **分离式处理**: UI和识别分离
- **定时器优化**: 减少更新频率
- **资源管理**: 及时释放音频资源

## 故障排除

### 常见问题

#### 1. 麦克风无法识别
- 检查麦克风权限设置
- 确认麦克风设备正常工作
- 尝试在设置中切换麦克风

#### 2. 识别不准确
- 确保环境安静
- 调整麦克风距离
- 检查网络连接（网络模式）

#### 3. 翻译失败
- 检查网络连接
- 确认语言包已正确安装
- 尝试重启应用

#### 4. 性能问题
- 关闭其他占用CPU的应用
- 尝试使用本地识别模式
- 调整音频采集参数

### 调试模式
如需查看详细日志，可以修改代码中的print语句或添加日志记录。

## 开发说明

### 代码结构
```
Real-time-voice-translation/
├── transparent_subtitle_optimized.py  # 主程序文件
├── model-cn/                          # 中文语音模型
├── model-en/                          # 英文语音模型
└── requirements.txt                   # 依赖列表
```

### 扩展开发
- 添加新的语言支持
- 集成其他翻译服务
- 自定义UI主题
- 添加录音功能

## 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 贡献指南

欢迎提交Issue和Pull Request来改进项目。

## 更新日志

### v1.0.0
- 初始版本发布
- 支持8种语言识别和翻译
- 实现透明悬浮字幕
- 添加音频可视化效果
- 支持网络和本地识别模式

---

**注意**: 使用网络识别模式需要稳定的网络连接，本地识别模式需要下载相应的语音模型。 